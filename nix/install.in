#!/usr/bin/env sh

{ # Prevent execution if this script was only partially downloaded
oops() {
    echo "$0:" "$@" >&2
    exit 1
}

case "$(uname -s).$(uname -m)" in
    Linux.x86_64) system=x86_64-linux;;
    Linux.i?86) system=i686-linux;;
    Linux.aarch64) system=aarch64-linux;;
    Darwin.x86_64) system=x86_64-darwin;;
    *) oops "sorry, there is no binary distribution of Nix for your platform";;
esac

url="https://nixos.org/releases/nix/nix-[%latestNixVersion%]/nix-[%latestNixVersion%]-$system.sh"
script=$(mktemp)

echo "downloading Nix [%latestNixVersion%] binary tarball for $system from '$url' to '$script'..."
curl -L "$url" -o "$tmp" || oops "failed to download '$url'"
"$script" "$@"

} # End of wrapping
