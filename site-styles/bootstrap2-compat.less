// One "unit" is equivalent to one pixel.
// (Assuming 14px or computed equivalent.)
@unit: 1/14rem;
@line-height: 1.429; // Empirically deduced in the browser.

// As a default
@gutter: 20*@unit;

@bs_radius: 6*@unit;
@bs_navbar_height: 40*@unit;

// Colors
@bs_color_default_foreground: #333;
@bs_color_default_background: #fff;
@bs_color_link_foreground: #08c;
@bs_color_link_hover_foreground: #005580;
@bs_color_menu_hover_foreground: #fff;
@bs_color_menu_hover_background: #0081c2;
@bs_color_menu_hover_background_start: #08c;
@bs_color_menu_hover_background_end: #0077b3;
@bs_color_nav_foreground: rgb(119, 119, 119);
@bs_color_nav_hover_foreground: @bs_color_default_foreground;

// Responsive rules for when the responsive menu is not in use
// REMINDER: Prefer setting the responsive rules first; override for larger widths. 
#bs-responsive-menu-wide(@rules) {
	#screen-sm-min({
		@rules();
	});
}
#bs-responsive-menu-narrow(@rules) {
	#screen-xs-max({
		@rules();
	});
}

// Basic catch-all rules
// ---------------------

html {
	// Assuming a browser default font size of 16px,
	// this is equivalent to 14px from bootstrap 2
	// font-size: 14px;
	font-size: (14/16) * 100%;
	// Note that **all** sizes will be relative from now on.
	// This means that a browser defaulting to a bigger size will have a scaled
	// up website by design.

	// line-height: 20px;
	line-height: @line-height;
}

body {
	font-size: 1rem;
	font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
	color: @bs_color_default_foreground;
	background-color: @bs_color_default_background;
	#screen-xs-max({
		padding-left: @gutter;
		padding-right: @gutter;
	});

	#bs-responsive-menu-wide({
		padding-top: @bs_navbar_height + @gutter;
	});
}

input, textarea, select {
	color: @bs_color_default_foreground;
	background-color: @bs_color_default_background;
}

a, .pretend-link {
	color: @bs_color_link_foreground;
	text-decoration: none;

	&:focus {
		outline: thin dotted #333;
		outline: 5*@unit auto -webkit-focus-ring-color;
		outline-offset: -2*@unit
	}

	&:hover, &:focus {
		color: @bs_color_link_hover_foreground;
		text-decoration: underline;
	}
}

hr {
	border-color: transparent;
	border-top: 1*@unit solid #eee;
	border-bottom: 1*@unit solid #fff;
	margin: @gutter 0;
}

ul {
	padding: 0;
	margin-top: 0;
	margin-right: 0;
	margin-bottom: @gutter;
	margin-left: @gutter;
}

table {
	border-collapse: collapse;
}

.hide {
	display: none;
}

// General, but specific, rules
// ----------------------------

.container {
	margin: auto;
	#screen-sm-min({ width: 724*@unit; });
	#screen-md-min({ width: 940*@unit; });
	#screen-lg-min({ width: 1170*@unit; });
}

// Layout-specific rules
// ---------------------

// Rows and spans
.row,
.row-fluid {
	margin-bottom: @gutter;

	// This recursive mixin creates a loop.
	._span(@_i) when (@_i > 0) {
		._span((@_i - 1));
		.span@{_i} {
			flex-grow: @_i;
			flex-shrink: @_i;
			#screen-sm-min({
				max-width: @_i/12 * 100%;
			});
		}
	}
	// The maximum supported `spanN`.
	._span(12);

	#screen-sm-min({
		display: flex;
		align-items: stretch;
		& > * {
			flex-basis: 0;
			&:not(:first-child) {
				padding-left: @gutter/2;
			}
			&:not(:last-child) {
				padding-right: @gutter/2;
			}
		}
		& > .span1,
		& > .span2,
		& > .span3,
		& > .span4,
		& > .span5,
		& > .span6,
		& > .span7,
		& > .span8,
		& > .span9,
		& > .span10,
		& > .span11,
		& > .span12 {
			& > :last-child {
				margin-bottom: @gutter;
			}
		}
	});
}


// Dropdown
.dropdown {
	position: relative;
	&:not(.open) .dropdown-menu {
		display: none;
	}
	.dropdown-menu {
		display: block;
		position: absolute;
		top: 100%;
		left: 0;
		// left: 50%;
		// transform: translateX(-50%)
		min-width: 160*@unit;
	}

	.dropdown-menu {
		padding: 5*@unit 0;
		margin: 2*@unit 0 0;
		background-color: @bs_color_default_background;
		border: @unit solid rgba(0, 0, 0, 0.2);
		border-radius: @bs_radius;
		list-style-type: none;
		box-shadow: 0 5*@unit 10*@unit rgba(0,0,0,0.2);
	}

	.dropdown-menu a {
		padding: 3*@unit @gutter;
		color: @bs_color_default_foreground;
		display: block;

		&:hover, &:focus {
			color: @bs_color_menu_hover_foreground;
			background-color: @bs_color_menu_hover_background;
			background-image: linear-gradient(
				to bottom
				, @bs_color_menu_hover_background_start
				, @bs_color_menu_hover_background_end
			);
		}
	}
}

// Navbar
body > .navbar {
	margin-bottom: @gutter;
	&.navbar-fixed-top {
		position: static;
		top: 0;
		left: 0;
		right: 0;
		z-index: 1050;
	}
	#bs-responsive-menu-wide({
		&.navbar-fixed-top {
			position: fixed;
		}
	});
	#bs-responsive-menu-narrow({
		margin-left: -@gutter;
		margin-right: -@gutter;
	});
}

.navbar {
	@_height: @bs_navbar_height;

	& > * {
		min-height: @_height;

		#bs-responsive-menu-wide({
			height: @_height;
		});
	}

	* {
		line-height: @_height;
	}
	ul, li {
		list-style-type: none;
	}
	a {
		display: block;
	}

	.brand {
		font-size: 20*@unit;
		#bs-responsive-menu-narrow({
			padding-left: @gutter;
		});
	}

	.navbar-inner > .container {
		display: flex;
	}

	// Bad assumption about the structure
	.navbar-inner > .container > div {
		display: flex;
		flex-grow: 1;
	}

	ul.nav {
		margin: 0;
		padding: 0;
		display: flex;
		#bs-responsive-menu-narrow({
			flex-direction: column;
		});
	}

	.pull-left {
		flex-grow: 1;
	}
	.pull-right {
		flex-grow: 0;
	}

	a {
		padding-left:  15*@unit;
		padding-right: 15*@unit;
		#screen-sm-only({
			padding-left:  10*@unit;
			padding-right: 10*@unit;
		});
		color: @bs_color_nav_foreground;
		&:hover, &:focus, &:active, &.active {
			color: @bs_color_nav_hover_foreground;
			text-decoration: none;
		}
	}

	.nav a {
		&:hover, &:focus, &:active, &.active {
			#bs-responsive-menu-narrow({
				color: @bs_color_menu_hover_foreground;
				background-color: @bs_color_menu_hover_background;
				background-image: linear-gradient(
				to bottom
				, @bs_color_menu_hover_background_start
				, @bs_color_menu_hover_background_end
				);
			});
		}
	}

	// Responsive menu
	.btn-navbar {
		@_size: @bs_navbar_height - @gutter/2;
		position: absolute;
		top: @gutter / 4;
		right: @gutter;
		height: @_size;
		width: @_size;
		// Working with the DOM we've been dealt with.
		z-index: 10;
		padding: 0;
		padding-top: 5*@unit;
		text-align: center;

		.icon-bar {
			display: block;
			margin: auto;
			border-top: 2*@unit solid @bs_color_default_foreground;
			margin-bottom: 4*@unit;
			width: @_size * 0.7;
			opacity: 0.35;
		}

		#bs-responsive-menu-wide({
			display: none;
		});
	}

	#bs-responsive-menu-narrow({
		.navbar-inner > .container {
			display: block;
		}
	});

	// Ugh, this is to fix a misbehaviour of the bootstrap imported CSS/JS.
	#bs-responsive-menu-wide({
		.nav-collapse.collapse {
			height: auto;
			overflow: visible;
		}
	});
}

.navbar-inner {
	background-color: rgb(250, 250, 250);
	background-image: linear-gradient(rgb(255, 255, 255), rgb(242, 242, 242));
	background-repeat: repeat-x;
	border-bottom: @unit solid rgb(212, 212, 212);
	box-shadow: rgba(0, 0, 0, 0.1) 0*@unit 1*@unit 10*@unit 0*@unit;
}

// Tabs
.tab-pane:not(.active) {
	display: none;
}
.nav-tabs {
	list-style-type: none;
	margin-left: 0;
}
.nav-tabs > li > a {
	&:hover, &:focus {
		text-decoration:none;
		background-color:#eee
	}
}
.tab-content {
	margin-bottom: @gutter;
}
